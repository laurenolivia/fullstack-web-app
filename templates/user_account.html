{% extends "base.html" %}


{% block body %}
    
Welcome, {{ session['fname'] }}!
<hr> 
    
{% endblock %}


{% block content %}

<form action="/logout">
    <input type="submit" name="Submit" value="Logout">
</form>


<div id="submit_data">

<p>Enter Today's Data:</p>

<!-- this form submits data to db -->
<!-- server.py will get data from this form -->
<!-- and create new instance of event on Event table -->

<form id="submit_form" action="/user_account" method="POST">

  <div class="poop_img" id="t1">
   <h1>Type 1</h1>
   <input style="display: none" type="radio" name="type" value="1">
    <img style="display: none" src="/static/poopimages/t1.jpg">
  </div>  

  <div class="poop_img" id="t2">
    <h1>Type 2</h1>
   <input style="display: none" type="radio" name="type" value="2">
    <img style="display: none" src="/static/poopimages/t2.jpg">
  </div>  

  <div class="poop_img" id="t3">
    <h1>Type 3</h1>
   <input style="display: none" type="radio" name="type" value="3">
    <img style="display: none" src="/static/poopimages/t3.jpg">
  </div>  

  <div class="poop_img" id="t4">
    <h1>Type 4</h1>
   <input style="display: none" type="radio" name="type" value="4">
    <img style="display: none" src="/static/poopimages/t4.jpg">
  </div>  

  <div class="poop_img" id="t5">
    <h1>Type 5</h1>
   <input style="display: none" type="radio" name="type" value="5">
    <img style="display: none" src="/static/poopimages/t5.jpg">
  </div>  

  <div class="poop_img" id="t6">
    <h1>Type 6</h1>
   <input style="display: none" type="radio" name="type" value="6">
    <img style="display: none" src="/static/poopimages/t6.jpg">
  </div>  

  <div class="poop_img" id="t7">
    <h1>Type 7</h1>
   <input style="display: none" type="radio" name="type" value="7">
    <img style="display: none" src="/static/poopimages/t7.jpg">
  </div>  


    <div>
        <p>Additional Comments:</p>
        <textarea id="comment" name="comment"></textarea>
    </div>
    
    <input type="submit" name="Submit">

</form>


</div>


<div id="display_data">

<!-- user_events queries Events table -->
<!-- .all() on user_events returns list of objects -->
{% for event in user_events %}

<p> <i>Type Name: </i> {{ event.event_type.type_name }}  
    <!-- event.event_at will access formatting from -->
    <!-- server.py on /user_account route -->
    <i>Date: </i>{{ event.event_at }} 
    <i>Comment: </i>{{ event.comment }} </p>

{% endfor %}
 

</div><div class='container'>
<canvas id="myChart" width="600" height="400"></canvas>
<p id="caption">This chart is displaying your poop data. Poop away!</p>
</div>


<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript">

// do not resize chart canvas (keep at 600x400)
// Chart.defaults.global.responsive = false;
// make ajax call 

//get scatter ID
// let ctx = document.getElementById('myChart').getContext('2d');

let ctx = document.getElementById('myChart').getContext('2d');



function getUserData(response){
    // evt.preventDefault();
    console.log(response);

    // let formInputs = {
    //   type: 29,
    //   comment: "hello",
    // }

    // localhost:5000/data?type=29&comment=hello
    
    //grab from database instead

    // make post/ajax request, sending new poop entry to /route
    // at callback function, make get/ajax request to get data
    // then at that callback from ajax, start parsing for graph/chart

    $.get("/data", function(data){
          console.log(">>> inside $.get(/data) <<<")
          console.log(">>> front end side <<<" + data);
          console.log(chart_data);
          let myChart = new Chart(ctx, {
    type: 'scatter',
    data: {
        datasets: [{
            label: 'Scatter Dataset',
            data: [{
                //on server side format data as x/y coordinates
                x: chart_data.x, 
                //pass data here remove chart from callback
                y: chart_data.y
            },  
            ]
        }]
    },
    options: {
        responsive: true,
        hoverMode: 'single',  //should always use single for scatter chart
        scales: {
            xAxes: [{
                type: 'linear',
                position: 'bottom'
            }]
        }
    }
});
  
  
    });
}

function submitData(evt) {
    //stop default reload from happening
    evt.preventDefault();

    //store form data in dict
    //'input[name=type]:checked' matches selected
    //element in radio form and get value
    let formInputs = {
        // "type": $("#submit_form").val(),
        'type': $('input[name=type]:checked').val(),
        'comment': $("#comment").val()
        
    };
    //verify value
    console.log(formInputs);

    //send data to route which will create new event
    //data comes from formInputs
    //callback function
    $.post("/user_account", 
         formInputs,
         getUserData);
}

// event listener on form instead of button
// get radio data and pass to callback function
$("#submit_form").on("submit", submitData)

</script>

<script type="text/javascript" src="/static/user_account.js"></script>

{% endblock %}

